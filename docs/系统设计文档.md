# 在线考试报名系统 - 系统设计文档

> 本科毕业设计 - 系统架构与数据库设计

---

## 1. 系统架构设计

### 1.1 总体架构

本系统采用 **前后端分离** 的 B/S 架构,分为三层:

```
┌─────────────────────────────────────────────────────────────────┐
│                          客户端层 (Browser)                        │
├─────────────────────────┬───────────────────────────────────────┤
│   考生端 (React)         │        管理端 (React)                  │
│   - 用户注册登录          │        - 考试管理                      │
│   - 在线报名             │        - 报名审核                      │
│   - 在线缴费             │        - 数据统计                      │
│   - 准考证打印           │        - 系统管理                      │
└─────────────────────────┴───────────────────────────────────────┘
                                    ↓ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────────┐
│                       应用服务层 (Spring Boot)                     │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ 用户模块     │  │ 考试模块     │  │ 报名模块     │             │
│  │ - 注册登录   │  │ - 考试管理   │  │ - 在线报名   │             │
│  │ - 个人信息   │  │ - 考点管理   │  │ - 报名审核   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │ 缴费模块     │  │ 通知模块     │  │ 统计模块     │             │
│  │ - 在线支付   │  │ - 消息通知   │  │ - 数据统计   │             │
│  │ - 订单管理   │  │ - 短信发送   │  │ - 报表导出   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
├─────────────────────────────────────────────────────────────────┤
│              通用组件 (Security / File / Utils)                   │
│  - Spring Security (认证授权)                                     │
│  - JWT Token (会话管理)                                           │
│  - MyBatis-Plus (ORM)                                           │
│  - 文件上传下载                                                    │
└─────────────────────────────────────────────────────────────────┘
                                    ↓ JDBC
┌─────────────────────────────────────────────────────────────────┐
│                         数据层 (MySQL 8.0)                        │
├─────────────────────────────────────────────────────────────────┤
│  user (用户表)  │  exam (考试表)  │  registration (报名表)        │
│  exam_site (考点) │ payment_order (订单) │ notice (公告)         │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 技术架构

#### 前端技术栈
- **框架**: React 18 + React Router
- **UI 组件**: Ant Design 5.x
- **状态管理**: React Hooks (useState, useContext)
- **HTTP 请求**: Axios
- **构建工具**: Vite
- **图表库**: ECharts (数据统计)

#### 后端技术栈
- **开发语言**: Java 11
- **核心框架**: Spring Boot 2.7.x
- **安全框架**: Spring Security + JWT
- **ORM 框架**: MyBatis-Plus 3.5.x
- **数据库**: MySQL 8.0
- **缓存**: Redis (可选)
- **工具类**: Hutool, Lombok

#### 第三方服务
- **支付接口**: 支付宝沙箱环境
- **短信服务**: 阿里云短信 (可选)
- **文件存储**: 本地存储 / 阿里云 OSS (可选)

### 1.3 部署架构

```
                    ┌─────────────┐
                    │   浏览器     │
                    └──────┬──────┘
                           │ HTTPS
                    ┌──────▼──────┐
                    │   Nginx     │ (反向代理 + 静态资源)
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │                         │
       ┌──────▼──────┐          ┌──────▼──────┐
       │  前端静态文件  │          │  Spring Boot │
       │   (React)    │          │  (Port 8080) │
       └──────────────┘          └──────┬──────┘
                                        │
                                 ┌──────▼──────┐
                                 │    MySQL    │
                                 │  (Port 3306)│
                                 └─────────────┘
```

---

## 2. 业务流程设计

### 2.1 考生报名流程图

```
开始
  │
  ▼
是否已注册?
  │
  ├─否─→ 注册账号 ─→ 短信验证 ─→ 设置密码
  │                              │
  ├─是─→ 登录系统 ◄───────────────┘
  │
  ▼
完善个人信息
  │
  ▼
浏览考试列表
  │
  ▼
选择考试查看详情
  │
  ▼
填写报名表单
  │
  ├─ 自动填充个人信息
  ├─ 选择考点
  └─ 上传证明材料
  │
  ▼
预览并提交报名
  │
  ▼
等待管理员审核
  │
  ├─────────────┐
  │             │
  ▼             ▼
审核通过     审核驳回
  │             │
  │             ▼
  │         查看驳回原因
  │             │
  │             ▼
  │         修改报名信息
  │             │
  │             └─────→ 重新提交 ──┐
  │                                │
  ◄────────────────────────────────┘
  │
  ▼
在线缴费
  │
  ├─ 选择支付方式
  └─ 跳转支付页面
  │
  ▼
支付成功?
  │
  ├─否─→ 重新支付
  │
  ├─是─→ 下载准考证
  │
  ▼
参加考试
  │
  ▼
结束
```

### 2.2 管理员审核流程图

```
开始
  │
  ▼
登录管理后台
  │
  ▼
进入报名审核模块
  │
  ▼
查看待审核列表
  │
  ├─ 按考试筛选
  ├─ 按状态筛选
  └─ 搜索考生
  │
  ▼
选择一条报名记录
  │
  ▼
查看报名详细信息
  │
  ├─ 个人基本信息
  ├─ 报考科目信息
  └─ 上传的证明材料
  │
  ▼
审核判断
  │
  ├──────────┬──────────┐
  │          │          │
  ▼          ▼          ▼
符合条件   不符合     批量审核
  │          │          │
  ▼          ▼          ▼
点击通过   点击驳回   选择多条
  │          │          │
  ▼          ▼          ▼
生成       填写驳回   批量通过
准考证号    原因
  │          │          │
  ▼          ▼          ▼
发送通知   发送通知   发送通知
  │          │          │
  └──────────┴──────────┘
  │
  ▼
继续审核下一条?
  │
  ├─是─→ 返回列表
  │
  ├─否─→ 查看统计数据
  │
  ▼
结束
```

### 2.3 系统核心用例图

```
考生端用例:
┌─────────────────────────────────────────┐
│                                         │
│   考生 (Actor)                           │
│     │                                   │
│     ├─→ 注册账号                         │
│     ├─→ 登录系统                         │
│     ├─→ 完善个人信息                     │
│     ├─→ 浏览考试列表                     │
│     ├─→ 在线报名                         │
│     ├─→ 查看报名状态                     │
│     ├─→ 修改报名信息                     │
│     ├─→ 在线缴费                         │
│     ├─→ 下载准考证                       │
│     └─→ 查看消息通知                     │
│                                         │
└─────────────────────────────────────────┘

管理端用例:
┌─────────────────────────────────────────┐
│                                         │
│   管理员 (Actor)                         │
│     │                                   │
│     ├─→ 登录管理后台                     │
│     ├─→ 创建考试                         │
│     ├─→ 编辑考试信息                     │
│     ├─→ 发布/下架考试                    │
│     ├─→ 管理考点                         │
│     ├─→ 审核报名信息                     │
│     ├─→ 批量审核                         │
│     ├─→ 查看缴费记录                     │
│     ├─→ 导出数据报表                     │
│     ├─→ 数据统计分析                     │
│     ├─→ 用户管理                         │
│     └─→ 发布公告                         │
│                                         │
└─────────────────────────────────────────┘
```

---

## 3. 数据库设计

### 3.1 E-R 图 (实体关系图)

```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│    用户      │         │    考试      │         │    考点      │
│   (user)    │         │   (exam)    │         │ (exam_site) │
├─────────────┤         ├─────────────┤         ├─────────────┤
│ id (PK)     │         │ id (PK)     │◄───┐    │ id (PK)     │
│ username    │         │ exam_name   │    │    │ site_name   │
│ password    │         │ exam_date   │    │    │ address     │
│ real_name   │         │ fee         │    │    │ exam_id (FK)│
│ id_card     │         │ status      │    │    └─────────────┘
│ phone       │         └─────────────┘    │
│ role        │               │            │
└─────────────┘               │            │
      │                       │            │
      │ 1                     │ 1          │
      │                       │            │
      │                       │            │
      │ N                     │ N          │
      │                       │            │
      │         ┌─────────────▼────────────┘
      │         │
      │         │       ┌─────────────┐
      └─────────┼──────►│    报名      │
                │       │(registration)│
                │       ├─────────────┤
                │       │ id (PK)     │
                │       │ exam_id (FK)│
                │       │ user_id (FK)│
                │       │ site_id (FK)│
                │       │ audit_status│
                │       │ payment_st. │
                │       └─────────────┘
                │             │
                │             │ 1
                │             │
                │             │
                │             │ 1
                │             │
                │       ┌─────▼───────┐
                └──────►│  缴费订单    │
                        │(payment_ord)│
                        ├─────────────┤
                        │ id (PK)     │
                        │ order_no    │
                        │ reg_id (FK) │
                        │ user_id (FK)│
                        │ amount      │
                        │ status      │
                        └─────────────┘

独立实体:
┌─────────────┐
│    公告      │
│  (notice)   │
├─────────────┤
│ id (PK)     │
│ title       │
│ content     │
│ is_top      │
│ status      │
└─────────────┘
```

### 3.2 表关系说明

| 关系 | 类型 | 说明 |
|------|------|------|
| user → registration | 1:N | 一个用户可以有多个报名记录 |
| exam → registration | 1:N | 一个考试可以有多个报名 |
| exam → exam_site | 1:N | 一个考试可以有多个考点 |
| exam_site → registration | 1:N | 一个考点可以有多个报名 |
| registration → payment_order | 1:1 | 一个报名对应一个缴费订单 |
| user → payment_order | 1:N | 一个用户可以有多个订单 |

---

## 4. 接口设计规范

### 4.1 RESTful API 设计原则

#### 请求格式
```
POST /api/v1/users/login
Content-Type: application/json

{
  "username": "13800138000",
  "password": "123456"
}
```

#### 响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "id": 1,
      "username": "13800138000",
      "realName": "张三",
      "role": "user"
    }
  },
  "timestamp": 1697894400000
}
```

### 4.2 接口模块划分

#### 用户模块
- `POST /api/v1/users/register` - 用户注册
- `POST /api/v1/users/login` - 用户登录
- `GET /api/v1/users/info` - 获取用户信息
- `PUT /api/v1/users/info` - 更新用户信息
- `POST /api/v1/users/avatar` - 上传头像

#### 考试模块
- `GET /api/v1/exams` - 获取考试列表
- `GET /api/v1/exams/{id}` - 获取考试详情
- `POST /api/v1/exams` - 创建考试 (管理员)
- `PUT /api/v1/exams/{id}` - 更新考试 (管理员)
- `DELETE /api/v1/exams/{id}` - 删除考试 (管理员)

#### 报名模块
- `POST /api/v1/registrations` - 提交报名
- `GET /api/v1/registrations/my` - 我的报名记录
- `GET /api/v1/registrations/{id}` - 获取报名详情
- `PUT /api/v1/registrations/{id}` - 修改报名信息
- `GET /api/v1/registrations/pending` - 待审核列表 (管理员)
- `POST /api/v1/registrations/{id}/audit` - 审核报名 (管理员)

#### 缴费模块
- `POST /api/v1/payments/create` - 创建支付订单
- `GET /api/v1/payments/{orderNo}` - 查询订单状态
- `POST /api/v1/payments/callback` - 支付回调

#### 统计模块
- `GET /api/v1/statistics/registration` - 报名统计
- `GET /api/v1/statistics/payment` - 缴费统计
- `GET /api/v1/statistics/audit` - 审核统计

### 4.3 状态码规范

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权,需要登录 |
| 403 | 无权限访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 5. 安全设计

### 5.1 认证与授权

**JWT Token 认证流程:**
```
1. 用户登录 → 验证用户名密码
2. 验证成功 → 生成 JWT Token (有效期 7 天)
3. 返回 Token → 前端存储到 localStorage
4. 后续请求 → Header 携带 Authorization: Bearer {token}
5. 后端拦截 → 验证 Token 有效性
6. 验证通过 → 执行业务逻辑
7. Token 过期 → 返回 401,前端跳转登录
```

**权限控制:**
- 考生只能访问考生端接口
- 管理员可以访问管理端接口
- 使用 Spring Security 进行统一拦截

### 5.2 数据安全

**敏感数据加密:**
- 密码: BCrypt 加密存储
- 身份证号: AES 加密存储
- 手机号: AES 加密存储

**传输安全:**
- 生产环境使用 HTTPS
- 敏感接口添加签名验证

### 5.3 防护措施

- **SQL 注入防护**: 使用 MyBatis 预编译语句
- **XSS 防护**: 前端对用户输入进行转义
- **CSRF 防护**: Token 验证机制
- **接口限流**: 同一 IP 每分钟最多 100 次请求
- **登录保护**: 连续失败 5 次锁定 30 分钟

---

## 6. 文件存储设计

### 6.1 文件类型

| 类型 | 格式 | 大小限制 | 说明 |
|------|------|----------|------|
| 头像 | JPG, PNG | 2MB | 用户头像 |
| 证明材料 | JPG, PNG, PDF | 5MB | 学历证书等 |
| 考试简章 | PDF | 10MB | 考试说明文档 |
| 准考证 | PDF | 1MB | 系统生成 |

### 6.2 存储方案

**开发环境:**
```
project/
  └── uploads/
      ├── avatars/        # 头像
      ├── materials/      # 证明材料
      ├── files/          # 考试简章
      └── tickets/        # 准考证
```

**生产环境:**
- 使用阿里云 OSS 存储
- 配置 CDN 加速访问
- 设置访问权限控制

### 6.3 文件命名规范

```
文件命名格式: {类型}_{用户ID}_{时间戳}_{随机码}.{扩展名}

示例:
- avatar_1001_1697894400000_a3f2.jpg
- material_1001_1697894401234_b5c9.pdf
```

---

## 7. 性能优化设计

### 7.1 数据库优化

**索引设计:**
- 主键索引: 所有表的 id 字段
- 唯一索引: username, order_no, admission_ticket_no
- 普通索引: exam_id, user_id, phone, id_card
- 联合索引: (exam_id, audit_status), (user_id, exam_id)

**分页查询:**
```sql
-- 使用 LIMIT 分页
SELECT * FROM registration
WHERE audit_status = 1
ORDER BY create_time DESC
LIMIT 0, 20;
```

### 7.2 缓存设计 (可选)

**Redis 缓存策略:**
- 考试列表: 缓存 10 分钟
- 考试详情: 缓存 30 分钟
- 用户信息: 缓存 1 小时
- 短信验证码: 缓存 5 分钟

### 7.3 前端优化

- 路由懒加载
- 组件按需加载
- 图片压缩
- 静态资源 CDN

---

**文档版本:** v1.0
**编制日期:** 2025-10-16
**编制人:** 系统设计组
